name: prodCI

on:
  workflow_dispatch:
    inputs:
      env:
        description: "Target environment"
        required: true
        default: dev
      deploy:
        description: "Deploy application?"
        required: true
        default: 'false'


env:
  APP_NAME: demo-app

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
      - name: Build
        run: echo "Building $APP_NAME for ${{ inputs.env }}"

  test:
    runs-on: ubuntu-latest
    needs: build
    strategy:
      matrix:
        test: [unit, e2e]
    steps:
      - name: Run tests
        run: echo "Running ${{ matrix.test }} tests for $APP_NAME"

  deploy:
    runs-on: ubuntu-latest
    needs: test
    if: ${{ inputs.deploy == 'true' }}

    environment:
      name: ${{ inputs.env }}

    steps:
      - name: Deploy
        run: echo "Deploying $APP_NAME to ${{ inputs.env }}"
